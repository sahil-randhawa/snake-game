<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Snake Game</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div id="score">0</div>
    <canvas id="gameCanvas" width="300" height="300"></canvas>
    <script src="script.js"></script>

    <script>
      /** CONSTANTS **/
      const CANVAS_BORDER_COLOUR = "black";
      const CANVAS_BACKGROUND_COLOUR = "white";
      const SNAKE_COLOUR = "lightgreen";
      const SNAKE_BORDER_COLOUR = "darkgreen";

      let snake = [
        { x: 150, y: 150 },
        { x: 140, y: 150 },
        { x: 130, y: 150 },
        { x: 120, y: 150 },
        { x: 110, y: 150 },
      ];

      // Horizontal velocity
      let dx = 10;
      // Vertical velocity
      let dy = 0;

      // Get the canvas element
      var gameCanvas = document.getElementById("gameCanvas");

      // Return a two dimensional drawing context
      var ctx = gameCanvas.getContext("2d");

      function clearCanvas() {
        ctx.fillStyle = "white";
        ctx.strokeStyle = "black";
        ctx.fillRect(0, 0, gameCanvas.width, gameCanvas.height);
        ctx.strokeRect(0, 0, gameCanvas.width, gameCanvas.height);
      }

      document.addEventListener("keydown", changeDirection);

      main();

      function main() {
        setTimeout(function onTick() {
          clearCanvas();
          advanceSnake();
          drawSnake();
          // Call main again
          main();
        }, 100);
      }

      /**
       * Advances the snake by changing the x-coordinates of its parts
       * according to the horizontal velocity and the y-coordinates of its parts
       * according to the vertical veolocity
       */
      function advanceSnake() {
        const head = { x: snake[0].x + dx, y: snake[0].y + dy };
        snake.unshift(head);
        snake.pop();
      }

      /**
       * Draws the snake on the canvas
       */
      function drawSnake() {
        // loop through the snake parts drawing each part on the canvas
        snake.forEach(drawSnakePart);
      }

      //  Draws a part of the snake on the canvas
      function drawSnakePart(snakePart) {
        // Set the colour of the snake part
        ctx.fillStyle = SNAKE_COLOUR;

        // Set the border colour of the snake part
        ctx.strokestyle = SNAKE_BORDER_COLOUR;

        // Draw a "filled" rectangle to represent the snake part at the coordinates
        // the part is located
        ctx.fillRect(snakePart.x, snakePart.y, 10, 10);

        // Draw a border around the snake part
        ctx.strokeRect(snakePart.x, snakePart.y, 10, 10);
      }

      //   Change the direction of the snake
      function changeDirection(event) {
        const LEFT_KEY = 37;
        const RIGHT_KEY = 39;
        const UP_KEY = 38;
        const DOWN_KEY = 40;
        const keyPressed = event.keyCode;
        const goingUp = dy === -10;
        const goingDown = dy === 10;
        const goingRight = dx === 10;
        const goingLeft = dx === -10;
        if (keyPressed === LEFT_KEY && !goingRight) {
          dx = -10;
          dy = 0;
        }
        if (keyPressed === UP_KEY && !goingDown) {
          dx = 0;
          dy = -10;
        }
        if (keyPressed === RIGHT_KEY && !goingLeft) {
          dx = 10;
          dy = 0;
        }
        if (keyPressed === DOWN_KEY && !goingDown) {
          dx = 0;
          dy = 10;
        }
      }
    </script>
  </body>
</html>
